FROM jenkins/agent:4.10-1

USER root

# Install required packages
RUN apt update
RUN apt install -y wget
RUN apt install -y npm
# Node 17 (current) has a bug with Node options not allowing OpenSSL
# Unsetting Node_options fixes this
RUN unset NODE_OPTIONS
# Install Google Chrome
RUN wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
RUN apt install -y ./google-chrome-stable_current_amd64.deb
# Cypress dependencies
RUN apt-get install -y \
      libgtk2.0-0 \
      libgtk-3-0 \
      libgbm-dev \
      libnotify-dev \
      libgconf-2-4 \
      libnss3 libxss1 \
      libasound2 \
      libxtst6 \
      xauth \
      xvfb

# Checkout repo
RUN git clone https://github.com/josequesadaGL/gorilla-practice.git
WORKDIR /gorilla-practice/

# Install project dependencies
RUN npm install
RUN $(npm bin)/cypress verify
