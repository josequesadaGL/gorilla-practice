FROM jenkins/agent:4.10-1

USER root

ENV CYPRESS_RECORD_KEY fe77ef76-0f9b-4690-8e32-eba83fb9a533
ENV CYPRESS_PROJECT_ID woj44y

# Install required packages
RUN apt update && \
apt install -y wget && \
apt install -y npm && \
# Node 17 (current) has a bug with Node options not allowing OpenSSL
# Unsetting Node_options fixes this
unset NODE_OPTIONS && \

# Install Google Chrome
wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb && \
apt install -y ./google-chrome-stable_current_amd64.deb && \
# Cypress dependencies
apt-get install -y \
      libgtk2.0-0 \
      libgtk-3-0 \
      libgbm-dev \
      libnotify-dev \
      libgconf-2-4 \
      libnss3 libxss1 \
      libasound2 \
      libxtst6 \
      xauth \
      xvfb && \

# Checkout repo
git clone https://github.com/josequesadaGL/gorilla-practice.git && \

cd gorilla-practice
# Install project dependencies
RUN npm install && npm run cypress:parallel
# RUN pwd
# RUN ls -l
# RUN npm run cypress:parallel
# USER jenkins
